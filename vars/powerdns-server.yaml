---
ports: 
  pdns_udp:
    host: 53
    container: 53
    protocol: udp
  pdns_tcp:
    host: 53
    container: 53
    protocol: tcp
  pdns_tcp:
    host: 8081
    container: 8081
    protocol: tcp
  frontend_https:
    host: 80
    container: 80
    protocol: tcp

pod_name: pdns

containers:
  powerdns-mariadb:
    image: mariadb:10.5
    environment:
      - MYSQL_ROOT_PASSWORD={{ powerdns_mariadb_rootpw }}
      - MYSQL_DATABASE={{ powerdns_mariadb_db }}
      - MYSQL_USER={{ powerdns_mariadb_user }}
      - MYSQL_PASSWORD={{ powerdns_mariadb_pw }}
    volumes:
      - "/podman/pv/powerdns/mariadb/:/var/lib/mysql:z"

  powerdns-backend:
    image: pschiffe/pdns-mysql:4.4-alpine
    environment:
      - PDNS_local_address=0.0.0.0
      - PDNS_gmysql_host=127.0.0.1
      - PDNS_gmysql_port=3306
      - PDNS_gmysql_dbname={{ powerdns_mariadb_db }}
      - PDNS_gmysql_user={{ powerdns_mariadb_user }}
      - PDNS_gmysql_password={{ powerdns_mariadb_pw }}
      - PDNS_master=yes
      - PDNS_api=yes
      - PDNS_api_key={{ powerdns_conf_api_key }}
      - PDNS_webserver=yes
      - PDNS_webserver_address=0.0.0.0
      - PDNS_webserver_password=secret2
      - PDNS_webserver-allow-from=10.0.0.0/8
      - PDNS_version_string=anonymous
      - PDNS_default_ttl=1500

  powerdns-frontend:
    image: ngoduykhanh/powerdns-admin:latest
    environment:
      - SECRET_KEY='{{ powerdns_frontend_secret_key }}'
    volumes:
      - "/podman/pv/powerdns/frontend/:/data:z"